var currentTrack="",currentPos=0,currentDuration=0,currentPlaylist="",getTime=function(a){if("undefined"==typeof a||0>=a)return{hours:0,minutes:0,seconds:0,position:0};var e,b,c;b=Math.floor(a/3600);0!=a%3600&&(e=Math.floor((a-3600*b)/60),c=0==(a-3600*b)%60?a:Math.floor((a-3600*b)%60));return{hours:b,minutes:e,seconds:c,position:a}},getAllPlaylists=function(){$.get("/itunes/cmd.php?q=all_playlists",function(a){a=a.split(";#;");$(".player .main .sidebar").outerWidth();$.each(a,function(a,b){var c=
$("<li />");35<=b.length&&(b=b.substr(0,32)+"...");c.text(b);b==currentPlaylist&&c.addClass("active-playlist");$(".player .main .sidebar ul").append(c)})})},getPlaylist=function(){$.get("/itunes/cmd.php?q=playlist",function(a){a=a.substr(0,a.length-3);$(".player .main .tracklist table tbody").html("");var a=a.split(";#;"),e=1;currentPlaylist=a[0].split("|");currentPlaylist=currentPlaylist[3];$.each(a,function(a,c){var f=c.split("|"),d=$("<tr />");1==e%2&&d.addClass("odd");f[1]==currentTrack[1]&&d.addClass("active-track");
d.append('<td class="track-no">'+e++ +"</td>");d.append('<td class="track-name">'+f[1]+"</td>");d.append('<td class="track-artist">'+f[0]+"</td>");d.append('<td class="track-album">'+f[2]+"</td>");$(".player .main .tracklist table tbody").append(d)})})},getTrackInfo=function(){$.get("/itunes/cmd.php?q=info",function(a){currentTrack=a.split("|");setTrackInfo()});$.get("/itunes/cmd.php?q=duration",function(a){currentDuration=getTime(a)})},getCurrentPosition=function(){$.get("/itunes/cmd.php?q=position",
function(a){currentPos>a&&(getTrackInfo(),getPlaylist());currentPos=a;currentTime=getTime(a);setTrackPosition()})},setTrackInfo=function(){if("false"==currentTrack[0])$(".player .toolbar .info-window .window #artist-album").text("-"),$(".player .toolbar .info-window .window #title").text("Player stopped!"),$(".player .toolbar .circle-button#playpause img").attr("src","images/Play.png");else switch($(".player .toolbar .info-window .window #artist-album").text(currentTrack[0]+" - "+currentTrack[2]),
$(".player .toolbar .info-window .window #title").text(currentTrack[1]),currentTrack[3]){case "play":$(".player .toolbar .circle-button#playpause img").attr("src","images/Pause.png");break;case "stop":case "pause":$(".player .toolbar .circle-button#playpause img").attr("src","images/Play.png")}},setTrackPosition=function(){"missing value"==currentTime.position?$(".player .toolbar .info-window .window #track-position").text("0:00"):$(".player .toolbar .info-window .window #track-position").text((0<
currentTime.hours?currentTime.hours+":":"")+currentTime.minutes+":"+(10>currentTime.seconds?"0"+currentTime.seconds:currentTime.seconds));if("missing value"==currentDuration.position){$(".player .toolbar .info-window .window #track-duration").text("0:00");var a=0}else $(".player .toolbar .info-window .window #track-duration").text((0<currentDuration.hours?currentDuration.hours+":":"")+currentDuration.minutes+":"+(10>currentDuration.seconds?"0"+currentDuration.seconds:currentDuration.seconds)),a=Math.round(100*
(currentTime.position/currentDuration.position));$(".player .toolbar .info-window .window #track-bar div").width(a+"%")},setClickEvents=function(){$(".player .toolbar .circle-button#playpause").click(function(){$.get("/itunes/cmd.php?q=playpause")});$(".player .toolbar .circle-button#prev").click(function(){$.get("/itunes/cmd.php?q=prev")});$(".player .toolbar .circle-button#next").click(function(){$.get("/itunes/cmd.php?q=next")})};
$(document).ready(function(){getTrackInfo();getPlaylist();getAllPlaylists();window.setInterval(getTrackInfo,5E3);window.setInterval(getCurrentPosition,1E3);setClickEvents()});
